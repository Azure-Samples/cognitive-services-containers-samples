# Azure Dev Spaces

[Azure Dev Spaces](http://aka.ms/devspaces) allows developers to iteratively run and debug containers directly in Azure Kubernetes Service (AKS), which makes developing an app that leverages Cognitive Services containers easy.

Simply deploy the service container to your cluster, and Azure Dev Spaces will do the work to run your local code in the cluster alongside the container!

## Set up Azure Dev Spaces

Follow a guide to [Get Started on Azure Dev Spaces](https://docs.microsoft.com/en-us/azure/dev-spaces/#get-started-on-azure-dev-spaces).

Since we're using a .NET Core sample here, we recommend the [Quickstart Guide for .NET Core and VS Code](https://docs.microsoft.com/en-us/azure/dev-spaces/quickstart-netcore).

## Deploy the Service Container

For this step we'll assume that you have `kubectl` configured to access your Kubernetes cluster that has been configured with Azure Dev Spaces.
> See [Use kubectl with an Azure Dev Space](https://docs.microsoft.com/en-us/azure/dev-spaces/how-to/use-kubectl-with-azure-dev-spaces) if you need help configuring kubectl to point at your Azure Dev Space cluster.

1) Deploy the service container to the cluster
    > Note: The values for `billing` and `apikey` must be replaced with valid values which can be obtained from your Azure cognitive services resource.

    ```
    kubectl run --image="mcr.microsoft.com/azure-cognitive-services/language" language --port=5000 --env="EULA=accept" --env="billing=https://<fill>.com" --env="apikey=<fill>"
    ```
2) Expose the service container to the cluster
    ```
    kubectl expose deployment language --port=5000 --name=language --type=ClusterIP
    ```

## Deploy a Test Application with Azure Dev Spaces

1) Clone the [Language Frontend](https://github.com/Azure-Samples/cognitive-services-containers-samples/tree/master/dotnet/Language/FrontendService/FrontendService) app sample.
    ```bash
    $ git clone https://github.com/Azure-Samples/cognitive-services-containers-samples.git
    ```
2) Change directory to the FrontendService folder:
    ```bash
    $ cd ./dotnet/Language/FrontendService/FrontendService
    ```
3) Generate Azure Dev Spaces assets
    ```bash
    $ azds prep --public
    ```
4) Build and run your code in AKS!
    ```bash
    azds up
    ```

The `azds up` command will output information regarding how to access your newly deployed application.
```bash
$ azds up
Using dev space 'default' with target '<your cluster>'
Synchronizing files...1s
Installing Helm chart...2s
Waiting for container image build...4s
...
Service 'frontendservice' port 80 (http) is available at http://localhost:49363
press Ctrl+C to detach
```

## Cleanup
To remove the resources generated by azure-dev-spaces, simply run `azds down`.

To remove the service container, you can run:
```
kubectl delete deploy/language
kubectl delete svc/language
```